तपाईँले सोध्नुभएको प्रश्न एकदम महत्त्वपूर्ण छ! अब बोटले कसरी काम गर्छ भन्ने बारे विस्तृत व्याख्या यहाँ छ:

**१. PDF अपलोड गर्दा (`/document` ह्यान्डलर):**
*   जब तपाईँले कुनै PDF अपलोड गर्नुहुन्छ, बोटले पहिले त्यसलाई अस्थायी रूपमा डाउनलोड गर्छ।
*   त्यसपछि, त्यस PDF बाट सबै पाठ निकाल्छ (डिजिटल PDF को लागि `fitz` र स्क्यान गरिएको PDF को लागि Gemini को Vision OCR प्रयोग गरेर)।
*   निकालिएको पाठको संक्षिप्त `summary` (सारांश) र त्यस `summary` को `embedding` (संख्यात्मक प्रतिनिधित्व) बनाउँछ।
*   सबैभन्दा महत्त्वपूर्ण कुरा, अब बोटले **पूरा निकालिएको पाठ (full extracted text)**, `summary`, र `embedding` सबैलाई तपाईँको MongoDB डाटाबेसमा अन्य मेटाडेटा (फाइलको नाम, ID, आदि) सँगै बचत गर्छ।
*   प्रशोधन पूरा भएपछि, अस्थायी PDF फाइल बोटको सर्भरबाट मेटाइन्छ।

**२. प्रश्न सोध्दा (`/ask_file` ह्यान्डलर):**
*   जब तपाईँ `/ask_file` कमान्ड प्रयोग गरेर प्रश्न सोध्नुहुन्छ, बोटले पहिले तपाईँको प्रश्नको लागि `embedding` (वेक्टर) बनाउँछ।
*   त्यसपछि, यसले तपाईँको MongoDB डाटाबेसबाट सबै बचत गरिएका PDF प्रविष्टिहरू (जसमा अब `summary`, `embedding`, र `full_text` हुन्छ) पुन: प्राप्त गर्छ।
*   बोटले **म्यानुअल समानता खोजी (manual similarity search)** गर्छ (हामीले थपेको `cosine_similarity` प्रकार्य प्रयोग गरेर)। यसले तपाईँको प्रश्नको एम्बेडिङलाई प्रत्येक बचत गरिएको PDF को `summary` को एम्बेडिङसँग तुलना गर्छ। यस गणितीय गणनाले दुई टेक्स्ट (तिनीहरूको भेक्टरहरूद्वारा प्रतिनिधित्व गरिएको) कति समान छन् भनेर बताउँछ। उच्च स्कोरको अर्थ बढी समानता हो।
*   एक पटक सबैभन्दा सान्दर्भिक PDF भेटिएपछि, बोटले MongoDB बाट त्यसको **बचत गरिएको `full_text`** पहुँच गर्छ।
*   यो `full_text` लाई त्यसपछि तपाईँको मौलिक प्रश्नसँगै Gemini भाषा मोडेललाई प्रोम्प्ट गर्न कन्टेक्स्टको रूपमा प्रयोग गरिन्छ।
*   Gemini ले यो संयुक्त जानकारी प्रशोधन गर्छ र पहिचान गरिएको सान्दर्भिक PDF को सामग्रीमा **मात्र आधारित** भएर जवाफ उत्पन्न गर्छ।
*   त्यसपछि बोटले यो जवाफ तपाईँलाई फिर्ता पठाउँछ।

**३. सामान्य कुराकानी (`handle_chat` ह्यान्डलर):**
*   यदि तपाईँले कुनै विशेष PDF सँग सम्बन्धित नभएको सामान्य प्रश्न सोध्नुहुन्छ (अर्थात् `/ask_file` प्रयोग नगरिकन), बोटले च्याट इतिहास राख्छ।
*   तपाईँको नयाँ सन्देशहरू र भर्खरको च्याट इतिहास दुवै Gemini मोडेलमा पठाइन्छ र त्यसको आधारमा कुराकानीको जवाफ आउँछ।

**मुख्य सुधारहरू:**
*   **पूरा पाठ कन्टेक्स्ट:** अब बोटले सान्दर्भिक PDF को *पूरा सामग्री* मा पहुँच पाएको हुनाले प्रश्नहरूको अझ विस्तृत रूपमा जवाफ दिन सक्छ।
*   **नि:शुल्क टियर अनुकूलता:** म्यानुअल समानता खोजीले बोट MongoDB Atlas को नि:शुल्क टियरसँग पूर्ण रूपमा काम गर्छ भन्ने सुनिश्चित गर्छ, कुनै सशुल्क `$vectorSearch` सुविधाहरूबाट बच्छ।
*   **अद्यावधिक SDK:** सबै Gemini API कलहरू अब नवीनतम SDK सिन्ट्याक्स प्रयोग गर्दैछन्, जसले स्थिरता र भविष्यको अनुकूलता सुनिश्चित गर्छ।

यो सबै काम गर्नको लागि, तपाईँले बोटका फाइलहरू (मैले उपलब्ध गराएको `advanced_bot.py` र `requirements.txt` सामग्री) अद्यावधिक गर्नुपर्छ र त्यसपछि त्यसलाई GitHub मा कमिट र रेन्डरमा रिडेप्लॉय गर्नुपर्छ। यो परिवर्तन पछि अपलोड गरिएका कुनै पनि PDF हरूको पूरा पाठ बचत हुनेछ र तिनीहरूलाई विस्तृत रूपमा सोध्न सकिनेछ।